diff --git a/src/config/ConfigManager.cpp b/src/config/ConfigManager.cpp
index 14d6cf0..c044086 100644
--- a/src/config/ConfigManager.cpp
+++ b/src/config/ConfigManager.cpp
@@ -3058,16 +3058,106 @@ std::optional<std::string> CConfigManager::handleSource(const std::string& comma
     return errorsFromParsing;
 }
 
+static std::string expandEnvVariables(const std::string& input) {
+    // Regex to match $VAR or ${VAR} with POSIX-compliant variable names
+    // POSIX: variable names must start with [a-zA-Z_] and contain [a-zA-Z0-9_]
+    // Group 0: entire match (e.g., "$VAR" or "${VAR}")
+    // Group 1: variable name from ${VAR} syntax
+    // Group 2: variable name from $VAR syntax
+
+    std::string result = input;
+    
+    std::vector<size_t> cumBackslashIndexes;
+    size_t backslashOffset = 0;
+    while (true) {
+        size_t i = result.find("\\$", backslashOffset);
+        if (i == std::string::npos)
+            break;
+        cumBackslashIndexes.push_back(i - backslashOffset + (cumBackslashIndexes.empty() ? 0 : 2));
+        backslashOffset = i + 2;
+    }
+
+    if (!cumBackslashIndexes.empty()) {
+        backslashOffset = 0;
+        std::vector<char> noBackslashes;
+        noBackslashes.reserve(result.size() - cumBackslashIndexes.size());
+        // a\$a\$\$ -> a$a$$
+        // 1 3 2
+        // "a" (1 3 2) "a$a" (1 2 2) "a$a$" (1 2 1) "a$a$$"
+        for (size_t i = 0; true; i++) {
+            size_t start = i == 0 ? 0 : backslashOffset + 1;
+            size_t end = i == cumBackslashIndexes.size() ? result.size() : backslashOffset + cumBackslashIndexes[i];
+            noBackslashes.insert(noBackslashes.end(), result.begin() + start, result.begin() + end);
+            if (i == cumBackslashIndexes.size())
+                break;
+            backslashOffset += cumBackslashIndexes[i];
+            if (i > 0)
+                cumBackslashIndexes[i]--;
+        }
+        result = std::string(noBackslashes.begin(), noBackslashes.end());
+    }
+    auto backslashIndex = cumBackslashIndexes.begin();
+    backslashOffset = 0;
+
+    static const RE2 varPattern(R".((\$\{([a-zA-Z_][a-zA-Z0-9_]*)\}|\$([a-zA-Z_][a-zA-Z0-9_]*))).");
+    
+    re2::StringPiece   fullMatch, bracedVar, dollarVar;
+    size_t offset = 0;
+    
+    // We need to iterate and replace from the beginning each time
+    while (true) {
+        re2::StringPiece searchPiece(result.c_str() + offset, result.size() - offset);
+        if (!RE2::PartialMatch(searchPiece, varPattern, &fullMatch, &bracedVar, &dollarVar)) {
+            break;
+        }
+        
+        // Find the full match position in the result string
+        size_t matchPos = result.find(fullMatch, offset);
+
+        while (backslashIndex != cumBackslashIndexes.end() && backslashOffset < matchPos) {
+            backslashOffset += *backslashIndex;
+            backslashIndex++;
+        }
+
+        if (backslashIndex != cumBackslashIndexes.begin() && backslashOffset == matchPos) {
+            offset = matchPos + fullMatch.size();
+            continue;
+        }
+        
+        // Determine which syntax matched and get the variable name
+        std::string varName(!bracedVar.empty() ? bracedVar : dollarVar);
+        
+        // Get the variable value from environment
+        const char* varValue = getenv(varName.c_str());
+        std::string replacement = varValue ? varValue : "";
+        
+        // Replace the match with the value
+        result.replace(matchPos, fullMatch.size(), replacement);
+
+        if (backslashIndex != cumBackslashIndexes.end()) {
+            backslashOffset += replacement.size() - fullMatch.size();
+            *backslashIndex += replacement.size() - fullMatch.size();
+        }
+        
+        // Move offset past the replacement to avoid infinite loops
+        offset = matchPos + replacement.size();
+    }
+
+    return result;
+}
+
 std::optional<std::string> CConfigManager::handleEnv(const std::string& command, const std::string& value) {
     if (!m_isFirstLaunch)
         return {};
 
     const auto ARGS = CVarList(value, 2);
 
-    if (ARGS[0].empty())
-        return "env empty";
+    // Expand environment variables in the value
+    std::string expandedValue = expandEnvVariables(ARGS[1]);
 
-    setenv(ARGS[0].c_str(), ARGS[1].c_str(), 1);
+    // Set the environment variable and check for errors
+    if (setenv(ARGS[0].c_str(), expandedValue.c_str(), 1) != 0)
+        return "failed to set environment variable " + ARGS[0] + ": " + strerror(errno);
 
     if (command.back() == 'd') {
         // dbus
